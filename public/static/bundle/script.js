(()=>{"use strict";new Map;const e=new Map,t=new Map,n={Div:"div",Text:"text"},r="append";function o(e){return e.type===n.Text}function l(e){return`k${e}`}function c(e){if(o(e)){const t=document.createDocumentFragment();return e.children.forEach((e=>{const n=document.createTextNode(e??"\n");t.appendChild(n)})),t}const{type:r,key:l,props:u,children:p=[]}=e,y=document.createElement(r);return t.set(l,y),p&&p.map((e=>{const r=c(e);return e.type!==n.Text&&t.set(e.key,r),r})).forEach((e=>y.appendChild(e))),y}function u(e,t,n="root"){const l=[];if(e.type!==t.type||e.key!==t.key)return l.push({type:"replace",parentKey:n,prevKey:e.key,lateKey:t.key}),l;if(o(e)||o(t))return l;const c=e.children,p=t.children,y=c.length,i=p.length;if(y!==i){const n=c.map((e=>e.key)),o=p.map((e=>e.key));if(y<i){const e=new Set(c.map((e=>e.key)));return o.filter((t=>!e.has(t))).forEach((e=>l.push({type:r,parentKey:t.key,prevKey:null,lateKey:e}))),l}if(y>i){const t=new Set(p.map((e=>e.key)));return n.filter((e=>!t.has(e))).forEach((t=>l.push({type:"remove",parentKey:e.key,prevKey:t,lateKey:null}))),l}}e.key!==t.key&&alert(`???? ${e.key}, ${t.key}`);for(let e=0;e<i;e++)l.push(...u(c[e],p[e],t.key));return l}const p=document.getElementById("root"),y=function(){let t=0;return function(r){const o=l(t++);return[o,function(c,...u){if(r===n.Text)return function(e,t){return{type:n.Text,key:e,children:Array.isArray(t)?t:[t]}}(o,u);const p=function(e,t,n=null,r){return{type:e,key:t,props:n,children:r}}(r,o,c,(e=>e.map((e=>"string"==typeof e?function(e,t){return{type:n.Text,key:l(e),children:[t]}}(t++,e):e)))(u));return e.set(o,p),p}]}}();let i;if(p){const[t,n]=y("div");let o,l,s=n(null,function(e="World"){return`Hello ${e}`}("root"));setTimeout((()=>{for(let e=1;e<5;e++){const[t,r]=y("text"),o=r(null,`text k${e}`),[l,c]=y("div"),u=c(null,o);s=n(null,...s.children,u)}o=structuredClone(s),console.log("v1",o),p.appendChild(c(s)),i=s,setTimeout((()=>{for(let e=1;e<5;e++){const[t,r]=y("text"),o=r(null,`text2 k${e}`),[l,c]=y("div"),u=c(null,o);s=n(null,...s.children,u)}var t;l=structuredClone(s),console.log("v2",l),t=u(o,l),console.log("patch",t),document.createDocumentFragment(),t.forEach((t=>{t.type===r&&e.get(t.parentKey)}))}),2e3)}),2e3)}else console.log("null")})();